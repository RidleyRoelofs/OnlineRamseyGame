#include "mainwindow.h"
#include <QVBoxLayout>
#include <QLabel> 
#include "maingamescreen.h"
#include <QLabel>
#include "game_state.hpp"

MainWindow::MainWindow(QWidget *parent)
    : QMainWindow(parent),
      stackedWidget(new QStackedWidget(this)),
      nextButton(new QPushButton("Next", this)),
      screenLabel(new QLabel("Start Screen", this))
{
    stackedWidget->addWidget(createStartScreen());
    stackedWidget->addWidget(createMainScreen());
    stackedWidget->addWidget(createEndScreen());

    connect(nextButton, SIGNAL(clicked()), this, SLOT(handleButton()));

    QVBoxLayout *layout = new QVBoxLayout;
    layout->addWidget(screenLabel); 
    layout->addWidget(stackedWidget);
    layout->addWidget(nextButton);

    QWidget *centralWidget = new QWidget(this);
    centralWidget->setLayout(layout);

    setCentralWidget(centralWidget);
}

MainWindow::~MainWindow()
{
}

void MainWindow::handleButton()
{
    int currentIndex = stackedWidget->currentIndex();
    if(currentIndex < stackedWidget->count() - 1) {
        stackedWidget->setCurrentIndex(currentIndex + 1);
    }
    else {
        stackedWidget->setCurrentIndex(0);
    }

    if (currentIndex == 0) {
        screenLabel->setText("Main Screen");
    } else if (currentIndex == 1) {
        screenLabel->setText("End Screen");
    } else {
        screenLabel->setText("Start Screen");
    }
}
// Create and return a new QWidget for the start screen
QWidget *MainWindow::createStartScreen()
{
    QLabel *firstNumberLabel = new QLabel("Red Path Size For Painter To Avoid:", this);
    QLabel *secondNumberLabel = new QLabel("Blue Cycle Size For Painter To Avoid:", this);

    QWidget *startScreenWidget = new QWidget(this);
    QVBoxLayout *layout = new QVBoxLayout;

    firstNumberSpinBox = new QSpinBox(this);
    firstNumberSpinBox->setRange(3, 6);

    secondNumberSpinBox = new QSpinBox(this);
    secondNumberSpinBox->setRange(3, 6);
    firstNumberSpinBox->setFixedSize(100,50);
    secondNumberSpinBox->setFixedSize(100,50);

    QPushButton *confirmButton = new QPushButton("Confirm", this);
    connect(confirmButton, SIGNAL(clicked()), this, SLOT(handleConfirmButton()));
    
    QHBoxLayout *firstNumberLayout = new QHBoxLayout;
    firstNumberLayout->addWidget(firstNumberLabel);
    firstNumberLayout->addWidget(firstNumberSpinBox);

    QHBoxLayout *secondNumberLayout = new QHBoxLayout;
    secondNumberLayout->addWidget(secondNumberLabel);
    secondNumberLayout->addWidget(secondNumberSpinBox);

    layout->addLayout(firstNumberLayout);
    layout->addLayout(secondNumberLayout);
    layout->addWidget(confirmButton);

    startScreenWidget->setLayout(layout);
    return startScreenWidget;
}

void MainWindow::handleConfirmButton()
{
    G1_size = firstNumberSpinBox->value();
    G2_size = secondNumberSpinBox->value();
    game.setG1Size(G1_size);
    game.setG2Size(G2_size);
}
void MainWindow::handleEndGame() {
    stackedWidget->setCurrentIndex(2);  // Change to your end screen
}

// Create and return a new QWidget for the main screen
QWidget* MainWindow::createMainScreen() {
    MainGameScreen* mainScreen = new MainGameScreen(&game, this);
    connect(mainScreen, SIGNAL(gameEnded()), this, SLOT(handleEndGame()));
    return mainScreen;
}
// Create and return a new QWidget for the end screen
QWidget *MainWindow::createEndScreen()
{
    return new QWidget(this);
}

